<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>08-LES-FORMULAIRES (AR)</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h1 id="les-formulaires--symfony-7.2">Les Formulaires | Symfony 7.2</h1>
<p>Voyons ensemble comment créer un formulaire avec Symfony 7.2 !</p>
<blockquote>
<p>Doc de référence :<br>
<a href="https://symfony.com/doc/current/forms.html">https://symfony.com/doc/current/forms.html</a></p>
</blockquote>
<p>Nous allons mettre en place un formulaire permettant de créer un article !</p>
<h2 id="création-du-formulaire">Création du Formulaire</h2>
<blockquote>
<p>Créons une nouvelle route dans notre <strong>ArticleController</strong></p>
</blockquote>
<pre class=" language-php"><code class="prism  language-php"><span class="token shell-comment comment">#[Route(</span><span class="token string">'/creer-un-article'</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'article_add'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">addArticle</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">,</span> EntityManagerInterface <span class="token variable">$entityManager</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Response 
<span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Dans notre console, le composant <strong>form</strong> est généralement déjà inclus dans une installation Symfony standard, mais si ce n’est pas le cas :</p>
<pre class=" language-bash"><code class="prism  language-bash">composer require symfony/form
</code></pre>
<p>Créons un nouvel objet <strong>Article</strong></p>
<pre class=" language-php"><code class="prism  language-php"><span class="token shell-comment comment"># Création d'un nouvel article</span>
<span class="token variable">$article</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Article</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Dans notre base de données, un Article est rédigé par un et un seul auteur. Pour le moment, nous allons le faire manuellement :</p>
<pre class=" language-php"><code class="prism  language-php"><span class="token variable">$auteur</span> <span class="token operator">=</span> <span class="token variable">$entityManager</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getRepository</span><span class="token punctuation">(</span>Auteur<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$article</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setAuteur</span><span class="token punctuation">(</span><span class="token variable">$auteur</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>La puissance de Symfony nous permet de créer notre formulaire en nous appuyant sur nos entités !</p>
<pre class=" language-php"><code class="prism  language-php"><span class="token variable">$form</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">createFormBuilder</span><span class="token punctuation">(</span><span class="token variable">$article</span><span class="token punctuation">)</span>
</code></pre>
<p>Nous allons maintenant créer nos différents champs :</p>
<pre class=" language-php"><code class="prism  language-php"><span class="token comment">// Champ TITREARTICLE</span>
<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'titre'</span><span class="token punctuation">,</span> TextType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string">'required'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string">'label'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Titre de l\'Article'</span><span class="token punctuation">,</span>
    <span class="token string">'attr'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token string">'class'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'form-control'</span><span class="token punctuation">,</span>
        <span class="token string">'placeholder'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Titre de l\'Article...'</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<blockquote>
<p>Consultez les différents types de champs disponibles :<br>
<a href="https://symfony.com/doc/current/reference/forms/types.html">https://symfony.com/doc/current/reference/forms/types.html</a></p>
</blockquote>
<p><strong>Nous avons besoin des champs suivants :</strong></p>
<ol>
<li>titre</li>
<li>categorie</li>
<li>contenu</li>
<li>featuredimage</li>
<li>special</li>
<li>spotlight</li>
<li>submit</li>
</ol>
<pre class=" language-php"><code class="prism  language-php"><span class="token comment">// N'oubliez pas d'importer les classes nécessaires</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Form<span class="token punctuation">\</span>Extension<span class="token punctuation">\</span>Core<span class="token punctuation">\</span>Type<span class="token punctuation">\</span>TextType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Form<span class="token punctuation">\</span>Extension<span class="token punctuation">\</span>Core<span class="token punctuation">\</span>Type<span class="token punctuation">\</span>TextareaType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Form<span class="token punctuation">\</span>Extension<span class="token punctuation">\</span>Core<span class="token punctuation">\</span>Type<span class="token punctuation">\</span>FileType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Form<span class="token punctuation">\</span>Extension<span class="token punctuation">\</span>Core<span class="token punctuation">\</span>Type<span class="token punctuation">\</span>CheckboxType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Form<span class="token punctuation">\</span>Extension<span class="token punctuation">\</span>Core<span class="token punctuation">\</span>Type<span class="token punctuation">\</span>SubmitType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Bridge<span class="token punctuation">\</span>Doctrine<span class="token punctuation">\</span>Form<span class="token punctuation">\</span>Type<span class="token punctuation">\</span>EntityType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Entity<span class="token punctuation">\</span>Categorie</span><span class="token punctuation">;</span>

<span class="token comment">// Ajout des champs</span>
<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'titre'</span><span class="token punctuation">,</span> TextType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string">'required'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string">'label'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Titre de l\'Article'</span><span class="token punctuation">,</span>
    <span class="token string">'attr'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token string">'class'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'form-control'</span><span class="token punctuation">,</span>
        <span class="token string">'placeholder'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Titre de l\'Article...'</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'categorie'</span><span class="token punctuation">,</span> EntityType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string">'class'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Categorie<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>
    <span class="token string">'choice_label'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'libelle'</span><span class="token punctuation">,</span>
    <span class="token string">'placeholder'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Choisir une catégorie'</span><span class="token punctuation">,</span>
    <span class="token string">'attr'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">'class'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'form-select'</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'contenu'</span><span class="token punctuation">,</span> TextareaType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string">'attr'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token string">'class'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'form-control'</span><span class="token punctuation">,</span>
        <span class="token string">'rows'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">10</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'featuredimage'</span><span class="token punctuation">,</span> FileType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string">'label'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Image principale'</span><span class="token punctuation">,</span>
    <span class="token string">'mapped'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string">'required'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string">'constraints'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            <span class="token string">'maxSize'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'2M'</span><span class="token punctuation">,</span>
            <span class="token string">'mimeTypes'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
                <span class="token string">'image/jpeg'</span><span class="token punctuation">,</span>
                <span class="token string">'image/png'</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'mimeTypesMessage'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Veuillez télécharger une image valide'</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'special'</span><span class="token punctuation">,</span> CheckboxType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string">'required'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">false</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'spotlight'</span><span class="token punctuation">,</span> CheckboxType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string">'required'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">false</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'submit'</span><span class="token punctuation">,</span> SubmitType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string">'label'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Créer l\'article'</span><span class="token punctuation">,</span>
    <span class="token string">'attr'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">'class'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'btn btn-primary mt-3'</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<p>Une fois que tous les champs ont été renseignés, nous finalisons le formulaire :</p>
<pre class=" language-php"><code class="prism  language-php"><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Puis nous le transmettons à la vue :</p>
<pre class=" language-php"><code class="prism  language-php"><span class="token shell-comment comment"># Affichage du Formulaire dans la Vue</span>
<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'article/ajouterarticle.html.twig'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string">'form'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$form</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">createView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="affichage-du-formulaire">Affichage du Formulaire</h2>
<p>Créons la vue <strong>ajouterarticle.html.twig</strong></p>
<p>La façon la plus simple d’afficher le formulaire :</p>
<pre class=" language-twig"><code class="prism  language-twig"><span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">form</span><span class="token punctuation">(</span><span class="token property">form</span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">}}</span></span></span>
</code></pre>
<blockquote>
<p>Doc de Référence : <a href="https://symfony.com/doc/current/forms.html#rendering-the-form">https://symfony.com/doc/current/forms.html#rendering-the-form</a></p>
</blockquote>
<p>Symfony 7.2 propose plusieurs thèmes de formulaires. Comme Bootstrap a évolué, nous utiliserons maintenant le thème compatible avec Bootstrap 5 :</p>
<pre class=" language-twig"><code class="prism  language-twig"><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">form_theme</span></span> <span class="token property">form</span> <span class="token string"><span class="token punctuation">'</span>bootstrap_5_layout.html.twig<span class="token punctuation">'</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span>  
<span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">form</span><span class="token punctuation">(</span><span class="token property">form</span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">}}</span></span></span>
</code></pre>
<p>Pour une mise en page plus personnalisée :</p>
<pre class=" language-twig"><code class="prism  language-twig"><span class="token comment">{# Titre de l'Article #}</span>
<span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>row<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>col-md-6 mx-auto<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text-center<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Créer un Article<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span></span>  
        <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">form_theme</span></span> <span class="token property">form</span> <span class="token string"><span class="token punctuation">'</span>bootstrap_5_layout.html.twig<span class="token punctuation">'</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span>  
        <span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">form</span><span class="token punctuation">(</span><span class="token property">form</span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">}}</span></span></span>  
    <span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
</code></pre>
<p>Pour la protection CSRF, celle-ci est intégrée par défaut dans Symfony 7.2, mais si vous avez besoin de l’installer explicitement :</p>
<pre class=" language-bash"><code class="prism  language-bash">composer require symfony/security-csrf
</code></pre>
<h2 id="traitement-du-formulaire">Traitement du Formulaire</h2>
<h3 id="valider-le-formulaire">Valider le Formulaire</h3>
<p>Nous injectons l’objet Request et EntityManagerInterface en paramètre de notre fonction :</p>
<pre class=" language-php"><code class="prism  language-php"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>HttpFoundation<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\</span>ORM<span class="token punctuation">\</span>EntityManagerInterface</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>HttpFoundation<span class="token punctuation">\</span>Response</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">addArticle</span><span class="token punctuation">(</span>
    Request <span class="token variable">$request</span><span class="token punctuation">,</span> 
    EntityManagerInterface <span class="token variable">$entityManager</span><span class="token punctuation">,</span>
    SluggerInterface <span class="token variable">$slugger</span>
<span class="token punctuation">)</span><span class="token punctuation">:</span> Response
</code></pre>
<p>Traitons les données POST :</p>
<pre class=" language-php"><code class="prism  language-php"><span class="token shell-comment comment"># Traitement des données POST</span>
<span class="token variable">$form</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token shell-comment comment"># Vérification des données du Formulaire</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$form</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">isSubmitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$form</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token shell-comment comment"># Récupération des données</span>
    <span class="token variable">$article</span> <span class="token operator">=</span> <span class="token variable">$form</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Traitement de l'upload...</span>
    
    <span class="token shell-comment comment"># Insertion en BDD</span>
    <span class="token variable">$entityManager</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">persist</span><span class="token punctuation">(</span><span class="token variable">$article</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$entityManager</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Redirection...</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="traitement-de-lupload-de-fichier">Traitement de l’Upload de Fichier</h3>
<blockquote>
<p>Doc de Référence :<br>
<a href="https://symfony.com/doc/current/controller/upload_file.html">https://symfony.com/doc/current/controller/upload_file.html</a></p>
</blockquote>
<p>Pour gérer l’upload de l’image :</p>
<pre class=" language-php"><code class="prism  language-php"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>HttpFoundation<span class="token punctuation">\</span>File<span class="token punctuation">\</span>Exception<span class="token punctuation">\</span>FileException</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>HttpFoundation<span class="token punctuation">\</span>File<span class="token punctuation">\</span>UploadedFile</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>String<span class="token punctuation">\</span>Slugger<span class="token punctuation">\</span>SluggerInterface</span><span class="token punctuation">;</span>

<span class="token comment">// À l'intérieur de la condition if ($form-&gt;isSubmitted() &amp;&amp; $form-&gt;isValid())</span>
<span class="token comment">/** @var UploadedFile $featuredImage */</span>
<span class="token variable">$featuredImage</span> <span class="token operator">=</span> <span class="token variable">$form</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'featuredimage'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$featuredImage</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$originalFilename</span> <span class="token operator">=</span> <span class="token function">pathinfo</span><span class="token punctuation">(</span><span class="token variable">$featuredImage</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getClientOriginalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">PATHINFO_FILENAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$safeFilename</span> <span class="token operator">=</span> <span class="token variable">$slugger</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">slug</span><span class="token punctuation">(</span><span class="token variable">$originalFilename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$newFilename</span> <span class="token operator">=</span> <span class="token variable">$safeFilename</span><span class="token punctuation">.</span><span class="token string">'-'</span><span class="token punctuation">.</span><span class="token function">uniqid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'.'</span><span class="token punctuation">.</span><span class="token variable">$featuredImage</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">guessExtension</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token variable">$featuredImage</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">move</span><span class="token punctuation">(</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">'featured_images_directory'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token variable">$newFilename</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileException</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Gestion de l'erreur</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">addFlash</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token string">'Un problème est survenu lors de l'</span>upload de l<span class="token string">'image'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token variable">$article</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setFeaturedimage</span><span class="token punctuation">(</span><span class="token variable">$newFilename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Notez que dans Symfony 7.2, vous devez définir votre dossier d’upload dans config/services.yaml :</p>
<pre class=" language-yaml"><code class="prism  language-yaml"><span class="token key atrule">parameters</span><span class="token punctuation">:</span>
    <span class="token key atrule">featured_images_directory</span><span class="token punctuation">:</span> <span class="token string">'%kernel.project_dir%/public/uploads/featured_images'</span>
</code></pre>
<p>Et créer ce dossier avec les bonnes permissions :</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">mkdir</span> -p public/uploads/featured_images
<span class="token function">chmod</span> -R 777 public/uploads/featured_images  <span class="token comment"># À ajuster selon l'environnement</span>
</code></pre>
<h3 id="enregistrer-larticle-en-bdd">Enregistrer l’article en BDD</h3>
<p>L’enregistrement de notre article se fait simplement :</p>
<pre class=" language-php"><code class="prism  language-php"><span class="token shell-comment comment"># Insertion en BDD</span>
<span class="token variable">$entityManager</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">persist</span><span class="token punctuation">(</span><span class="token variable">$article</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$entityManager</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="redirection">Redirection</h3>
<pre class=" language-php"><code class="prism  language-php"><span class="token shell-comment comment"># Redirection sur l</span><span class="token string">'Article qui vient d'</span>être créé<span class="token punctuation">.</span>
<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">redirectToRoute</span><span class="token punctuation">(</span><span class="token string">'index_article'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string">'libellecategorie'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$sluggerService</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">slugify</span><span class="token punctuation">(</span><span class="token variable">$article</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getCategorie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getLibelle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'slugarticle'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$sluggerService</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">slugify</span><span class="token punctuation">(</span><span class="token variable">$article</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getTitre</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$article</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="aller-plus-loin-avec-les-formtype">Aller plus loin avec les FormType</h2>
<p>Plutôt que de créer notre formulaire directement dans le contrôleur, nous allons le déplacer dans une classe dédiée.</p>
<h3 id="création-dun-custom-formtype">Création d’un Custom FormType</h3>
<p>Créons une classe FormType dédiée avec la commande :</p>
<pre class=" language-bash"><code class="prism  language-bash">php bin/console make:form ArticleType
</code></pre>
<p>Cela va créer src/Form/ArticleType.php :</p>
<pre class=" language-php"><code class="prism  language-php"><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Form</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Entity<span class="token punctuation">\</span>Article</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Entity<span class="token punctuation">\</span>Categorie</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Bridge<span class="token punctuation">\</span>Doctrine<span class="token punctuation">\</span>Form<span class="token punctuation">\</span>Type<span class="token punctuation">\</span>EntityType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Form<span class="token punctuation">\</span>AbstractType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Form<span class="token punctuation">\</span>Extension<span class="token punctuation">\</span>Core<span class="token punctuation">\</span>Type<span class="token punctuation">\</span>CheckboxType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Form<span class="token punctuation">\</span>Extension<span class="token punctuation">\</span>Core<span class="token punctuation">\</span>Type<span class="token punctuation">\</span>FileType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Form<span class="token punctuation">\</span>Extension<span class="token punctuation">\</span>Core<span class="token punctuation">\</span>Type<span class="token punctuation">\</span>SubmitType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Form<span class="token punctuation">\</span>Extension<span class="token punctuation">\</span>Core<span class="token punctuation">\</span>Type<span class="token punctuation">\</span>TextareaType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Form<span class="token punctuation">\</span>Extension<span class="token punctuation">\</span>Core<span class="token punctuation">\</span>Type<span class="token punctuation">\</span>TextType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Form<span class="token punctuation">\</span>FormBuilderInterface</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>OptionsResolver<span class="token punctuation">\</span>OptionsResolver</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Validator<span class="token punctuation">\</span>Constraints<span class="token punctuation">\</span>File</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ArticleType</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractType</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">buildForm</span><span class="token punctuation">(</span>FormBuilderInterface <span class="token variable">$builder</span><span class="token punctuation">,</span> <span class="token keyword">array</span> <span class="token variable">$options</span><span class="token punctuation">)</span><span class="token punctuation">:</span> void
    <span class="token punctuation">{</span>
        <span class="token variable">$builder</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'titre'</span><span class="token punctuation">,</span> TextType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
                <span class="token string">'required'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token string">'label'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token string">'attr'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
                    <span class="token string">'class'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'form-control'</span><span class="token punctuation">,</span>
                    <span class="token string">'placeholder'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Titre de l\'Article...'</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'categorie'</span><span class="token punctuation">,</span> EntityType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
                <span class="token string">'class'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Categorie<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>
                <span class="token string">'choice_label'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'libelle'</span><span class="token punctuation">,</span>
                <span class="token string">'placeholder'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Choisir une catégorie'</span><span class="token punctuation">,</span>
                <span class="token string">'attr'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">'class'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'form-select'</span><span class="token punctuation">]</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'contenu'</span><span class="token punctuation">,</span> TextareaType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
                <span class="token string">'attr'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
                    <span class="token string">'class'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'form-control'</span><span class="token punctuation">,</span>
                    <span class="token string">'rows'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">10</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'featuredimage'</span><span class="token punctuation">,</span> FileType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
                <span class="token string">'label'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Image principale'</span><span class="token punctuation">,</span>
                <span class="token string">'mapped'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token string">'required'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token string">'constraints'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
                    <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                        <span class="token string">'maxSize'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'2M'</span><span class="token punctuation">,</span>
                        <span class="token string">'mimeTypes'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
                            <span class="token string">'image/jpeg'</span><span class="token punctuation">,</span>
                            <span class="token string">'image/png'</span><span class="token punctuation">,</span>
                        <span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token string">'mimeTypesMessage'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Veuillez télécharger une image valide'</span><span class="token punctuation">,</span>
                    <span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'special'</span><span class="token punctuation">,</span> CheckboxType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
                <span class="token string">'required'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">false</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'spotlight'</span><span class="token punctuation">,</span> CheckboxType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
                <span class="token string">'required'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">false</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'submit'</span><span class="token punctuation">,</span> SubmitType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
                <span class="token string">'label'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Créer l\'article'</span><span class="token punctuation">,</span>
                <span class="token string">'attr'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">'class'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'btn btn-primary mt-3'</span><span class="token punctuation">]</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">configureOptions</span><span class="token punctuation">(</span>OptionsResolver <span class="token variable">$resolver</span><span class="token punctuation">)</span><span class="token punctuation">:</span> void
    <span class="token punctuation">{</span>
        <span class="token variable">$resolver</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setDefaults</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            <span class="token string">'data_class'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Article<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Ensuite, depuis notre contrôleur, nous simplifions la création du formulaire :</p>
<pre class=" language-php"><code class="prism  language-php"><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Form<span class="token punctuation">\</span>ArticleType</span><span class="token punctuation">;</span>

<span class="token comment">// Au lieu de createFormBuilder</span>
<span class="token variable">$form</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">createForm</span><span class="token punctuation">(</span>ArticleType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token variable">$article</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Le reste du code reste identique.</p>
<h2 id="validation-des-données-avec-les-attributs">Validation des données avec les Attributs</h2>
<p>Symfony 7.2 utilise des attributs PHP 8 pour la validation directement dans les entités :</p>
<pre class=" language-php"><code class="prism  language-php"><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Entity</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\</span>ORM<span class="token punctuation">\</span>Mapping</span> <span class="token keyword">as</span> <span class="token constant">ORM</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Validator<span class="token punctuation">\</span>Constraints</span> <span class="token keyword">as</span> Assert<span class="token punctuation">;</span>

<span class="token shell-comment comment">#[ORM\Entity(repositoryClass: ArticleRepository::class)]</span>
<span class="token keyword">class</span> <span class="token class-name">Article</span>
<span class="token punctuation">{</span>
    <span class="token shell-comment comment">#[ORM\Id]</span>
    <span class="token shell-comment comment">#[ORM\GeneratedValue]</span>
    <span class="token shell-comment comment">#[ORM\Column]</span>
    <span class="token keyword">private</span> <span class="token operator">?</span>int <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token shell-comment comment">#[ORM\Column(length: 255)]</span>
    <span class="token shell-comment comment">#[Assert\NotBlank(message: </span><span class="token string">"Le titre ne peut pas être vide"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token shell-comment comment">#[Assert\Length(</span>
        min<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> 
        max<span class="token punctuation">:</span> <span class="token number">255</span><span class="token punctuation">,</span> 
        minMessage<span class="token punctuation">:</span> <span class="token string">"Le titre doit contenir au moins {{ limit }} caractères"</span><span class="token punctuation">,</span>
        maxMessage<span class="token punctuation">:</span> <span class="token string">"Le titre ne peut pas dépasser {{ limit }} caractères"</span>
    <span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">private</span> <span class="token operator">?</span>string <span class="token variable">$titre</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    
    <span class="token shell-comment comment">#[ORM\ManyToOne(targetEntity: Categorie::class, inversedBy: </span><span class="token string">'articles'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token shell-comment comment">#[ORM\JoinColumn(nullable: false)]</span>
    <span class="token shell-comment comment">#[Assert\NotNull(message: </span><span class="token string">"Veuillez choisir une catégorie"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">private</span> <span class="token operator">?</span>Categorie <span class="token variable">$categorie</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    
    <span class="token shell-comment comment">#[ORM\Column(type: </span><span class="token string">'text'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token shell-comment comment">#[Assert\NotBlank(message: </span><span class="token string">"Le contenu ne peut pas être vide"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token shell-comment comment">#[Assert\Length(</span>
        min<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        minMessage<span class="token punctuation">:</span> <span class="token string">"Le contenu doit contenir au moins {{ limit }} caractères"</span>
    <span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">private</span> <span class="token operator">?</span>string <span class="token variable">$contenu</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    
    <span class="token shell-comment comment">#[ORM\Column(length: 255, nullable: true)]</span>
    <span class="token keyword">private</span> <span class="token operator">?</span>string <span class="token variable">$featuredimage</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    
    <span class="token shell-comment comment">#[ORM\Column]</span>
    <span class="token keyword">private</span> bool <span class="token variable">$special</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    
    <span class="token shell-comment comment">#[ORM\Column]</span>
    <span class="token keyword">private</span> bool <span class="token variable">$spotlight</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Getters et setters...</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="exemple-complet-du-contrôleur">Exemple complet du contrôleur</h2>
<pre class=" language-php"><code class="prism  language-php"><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Entity<span class="token punctuation">\</span>Article</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Entity<span class="token punctuation">\</span>Auteur</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Form<span class="token punctuation">\</span>ArticleType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Service<span class="token punctuation">\</span>SluggerService</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\</span>ORM<span class="token punctuation">\</span>EntityManagerInterface</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Bundle<span class="token punctuation">\</span>FrameworkBundle<span class="token punctuation">\</span>Controller<span class="token punctuation">\</span>AbstractController</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>HttpFoundation<span class="token punctuation">\</span>File<span class="token punctuation">\</span>Exception<span class="token punctuation">\</span>FileException</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>HttpFoundation<span class="token punctuation">\</span>File<span class="token punctuation">\</span>UploadedFile</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>HttpFoundation<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>HttpFoundation<span class="token punctuation">\</span>Response</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Routing<span class="token punctuation">\</span>Attribute<span class="token punctuation">\</span>Route</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>String<span class="token punctuation">\</span>Slugger<span class="token punctuation">\</span>SluggerInterface</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ArticleController</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractController</span>
<span class="token punctuation">{</span>
    <span class="token shell-comment comment">#[Route(</span><span class="token string">'/creer-un-article'</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'article_add'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">addArticle</span><span class="token punctuation">(</span>
        Request <span class="token variable">$request</span><span class="token punctuation">,</span> 
        EntityManagerInterface <span class="token variable">$entityManager</span><span class="token punctuation">,</span>
        SluggerService <span class="token variable">$sluggerService</span><span class="token punctuation">,</span>
        SluggerInterface <span class="token variable">$slugger</span>
    <span class="token punctuation">)</span><span class="token punctuation">:</span> Response 
    <span class="token punctuation">{</span>
        <span class="token comment">// Création d'un nouvel article</span>
        <span class="token variable">$article</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Article</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// Associer un auteur (à remplacer par la récupération de l'utilisateur connecté)</span>
        <span class="token variable">$auteur</span> <span class="token operator">=</span> <span class="token variable">$entityManager</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getRepository</span><span class="token punctuation">(</span>Auteur<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$article</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setAuteur</span><span class="token punctuation">(</span><span class="token variable">$auteur</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// Création du formulaire</span>
        <span class="token variable">$form</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">createForm</span><span class="token punctuation">(</span>ArticleType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token variable">$article</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// Traitement du formulaire</span>
        <span class="token variable">$form</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$form</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">isSubmitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$form</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Gestion de l'upload de l'image</span>
            <span class="token comment">/** @var UploadedFile $featuredImage */</span>
            <span class="token variable">$featuredImage</span> <span class="token operator">=</span> <span class="token variable">$form</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'featuredimage'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$featuredImage</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$originalFilename</span> <span class="token operator">=</span> <span class="token function">pathinfo</span><span class="token punctuation">(</span><span class="token variable">$featuredImage</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getClientOriginalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">PATHINFO_FILENAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$safeFilename</span> <span class="token operator">=</span> <span class="token variable">$slugger</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">slug</span><span class="token punctuation">(</span><span class="token variable">$originalFilename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$newFilename</span> <span class="token operator">=</span> <span class="token variable">$safeFilename</span><span class="token punctuation">.</span><span class="token string">'-'</span><span class="token punctuation">.</span><span class="token function">uniqid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'.'</span><span class="token punctuation">.</span><span class="token variable">$featuredImage</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">guessExtension</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token variable">$featuredImage</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">move</span><span class="token punctuation">(</span>
                        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">'featured_images_directory'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token variable">$newFilename</span>
                    <span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileException</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">addFlash</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token string">'Un problème est survenu lors de l\'upload de l\'image'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                
                <span class="token variable">$article</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setFeaturedimage</span><span class="token punctuation">(</span><span class="token variable">$newFilename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            
            <span class="token comment">// Enregistrement en base de données</span>
            <span class="token variable">$entityManager</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">persist</span><span class="token punctuation">(</span><span class="token variable">$article</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$entityManager</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// Message de succès</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">addFlash</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">,</span> <span class="token string">'Article créé avec succès !'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// Redirection vers l'article créé</span>
            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">redirectToRoute</span><span class="token punctuation">(</span><span class="token string">'index_article'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
                <span class="token string">'libellecategorie'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$sluggerService</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">slugify</span><span class="token punctuation">(</span><span class="token variable">$article</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getCategorie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getLibelle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'slugarticle'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$sluggerService</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">slugify</span><span class="token punctuation">(</span><span class="token variable">$article</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getTitre</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$article</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// Affichage du formulaire</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'article/ajouterarticle.html.twig'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
            <span class="token string">'form'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$form</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">createView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="créer-un-formulaire-dinscription-dauteur">Créer un formulaire d’inscription d’Auteur</h2>
<p>D’abord, créons le formulaire :</p>
<pre class=" language-bash"><code class="prism  language-bash">php bin/console make:form AuteurType
</code></pre>
<p>Ensuite, dans src/Form/AuteurType.php :</p>
<pre class=" language-php"><code class="prism  language-php"><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Form</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Entity<span class="token punctuation">\</span>Auteur</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Form<span class="token punctuation">\</span>AbstractType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Form<span class="token punctuation">\</span>Extension<span class="token punctuation">\</span>Core<span class="token punctuation">\</span>Type<span class="token punctuation">\</span>EmailType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Form<span class="token punctuation">\</span>Extension<span class="token punctuation">\</span>Core<span class="token punctuation">\</span>Type<span class="token punctuation">\</span>PasswordType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Form<span class="token punctuation">\</span>Extension<span class="token punctuation">\</span>Core<span class="token punctuation">\</span>Type<span class="token punctuation">\</span>RepeatedType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Form<span class="token punctuation">\</span>Extension<span class="token punctuation">\</span>Core<span class="token punctuation">\</span>Type<span class="token punctuation">\</span>SubmitType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Form<span class="token punctuation">\</span>Extension<span class="token punctuation">\</span>Core<span class="token punctuation">\</span>Type<span class="token punctuation">\</span>TextType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Form<span class="token punctuation">\</span>FormBuilderInterface</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>OptionsResolver<span class="token punctuation">\</span>OptionsResolver</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Validator<span class="token punctuation">\</span>Constraints<span class="token punctuation">\</span>Email</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Validator<span class="token punctuation">\</span>Constraints<span class="token punctuation">\</span>Length</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Validator<span class="token punctuation">\</span>Constraints<span class="token punctuation">\</span>NotBlank</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AuteurType</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractType</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">buildForm</span><span class="token punctuation">(</span>FormBuilderInterface <span class="token variable">$builder</span><span class="token punctuation">,</span> <span class="token keyword">array</span> <span class="token variable">$options</span><span class="token punctuation">)</span><span class="token punctuation">:</span> void
    <span class="token punctuation">{</span>
        <span class="token variable">$builder</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'nom'</span><span class="token punctuation">,</span> TextType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
                <span class="token string">'attr'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
                    <span class="token string">'class'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'form-control'</span><span class="token punctuation">,</span>
                    <span class="token string">'placeholder'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Votre nom'</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">'constraints'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
                    <span class="token keyword">new</span> <span class="token class-name">NotBlank</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'message'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Veuillez saisir votre nom'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token keyword">new</span> <span class="token class-name">Length</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                        <span class="token string">'min'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">,</span>
                        <span class="token string">'minMessage'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Votre nom doit contenir au moins {{ limit }} caractères'</span>
                    <span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'prenom'</span><span class="token punctuation">,</span> TextType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
                <span class="token string">'attr'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
                    <span class="token string">'class'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'form-control'</span><span class="token punctuation">,</span>
                    <span class="token string">'placeholder'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Votre prénom'</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">'constraints'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
                    <span class="token keyword">new</span> <span class="token class-name">NotBlank</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'message'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Veuillez saisir votre prénom'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token keyword">new</span> <span class="token class-name">Length</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                        <span class="token string">'min'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">,</span>
                        <span class="token string">'minMessage'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Votre prénom doit contenir au moins {{ limit }} caractères'</span>
                    <span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'email'</span><span class="token punctuation">,</span> EmailType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
                <span class="token string">'attr'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
                    <span class="token string">'class'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'form-control'</span><span class="token punctuation">,</span>
                    <span class="token string">'placeholder'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Votre email'</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">'constraints'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
                    <span class="token keyword">new</span> <span class="token class-name">NotBlank</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'message'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Veuillez saisir votre email'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token keyword">new</span> <span class="token class-name">Email</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'message'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Veuillez saisir un email valide'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">,</span> RepeatedType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
                <span class="token string">'type'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> PasswordType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>
                <span class="token string">'invalid_message'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Les mots de passe doivent correspondre'</span><span class="token punctuation">,</span>
                <span class="token string">'first_options'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
                    <span class="token string">'label'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Mot de passe'</span><span class="token punctuation">,</span>
                    <span class="token string">'attr'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
                        <span class="token string">'class'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'form-control'</span><span class="token punctuation">,</span>
                        <span class="token string">'placeholder'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Votre mot de passe'</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">'second_options'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
                    <span class="token string">'label'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Confirmation du mot de passe'</span><span class="token punctuation">,</span>
                    <span class="token string">'attr'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
                        <span class="token string">'class'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'form-control'</span><span class="token punctuation">,</span>
                        <span class="token string">'placeholder'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Confirmez votre mot de passe'</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">'constraints'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
                    <span class="token keyword">new</span> <span class="token class-name">NotBlank</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'message'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Veuillez saisir un mot de passe'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token keyword">new</span> <span class="token class-name">Length</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                        <span class="token string">'min'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">8</span><span class="token punctuation">,</span>
                        <span class="token string">'minMessage'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Votre mot de passe doit contenir au moins {{ limit }} caractères'</span>
                    <span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'submit'</span><span class="token punctuation">,</span> SubmitType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
                <span class="token string">'label'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'S\'inscrire'</span><span class="token punctuation">,</span>
                <span class="token string">'attr'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">'class'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'btn btn-primary mt-3'</span><span class="token punctuation">]</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">configureOptions</span><span class="token punctuation">(</span>OptionsResolver <span class="token variable">$resolver</span><span class="token punctuation">)</span><span class="token punctuation">:</span> void
    <span class="token punctuation">{</span>
        <span class="token variable">$resolver</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setDefaults</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            <span class="token string">'data_class'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Auteur<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Créons le contrôleur pour l’inscription :</p>
<pre class=" language-php"><code class="prism  language-php"><span class="token shell-comment comment">#[Route(</span><span class="token string">'/inscription'</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'auteur_register'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">register</span><span class="token punctuation">(</span>
    Request <span class="token variable">$request</span><span class="token punctuation">,</span> 
    EntityManagerInterface <span class="token variable">$entityManager</span><span class="token punctuation">,</span>
    UserPasswordHasherInterface <span class="token variable">$passwordHasher</span>
<span class="token punctuation">)</span><span class="token punctuation">:</span> Response
<span class="token punctuation">{</span>
    <span class="token variable">$auteur</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Auteur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$form</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">createForm</span><span class="token punctuation">(</span>AuteurType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token variable">$auteur</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token variable">$form</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$form</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">isSubmitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$form</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Hashage du mot de passe</span>
        <span class="token variable">$hashedPassword</span> <span class="token operator">=</span> <span class="token variable">$passwordHasher</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hashPassword</span><span class="token punctuation">(</span>
            <span class="token variable">$auteur</span><span class="token punctuation">,</span>
            <span class="token variable">$form</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$auteur</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token variable">$hashedPassword</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// Enregistrement en base de données</span>
        <span class="token variable">$entityManager</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">persist</span><span class="token punctuation">(</span><span class="token variable">$auteur</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$entityManager</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// Message de succès</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">addFlash</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">,</span> <span class="token string">'Inscription réussie ! Vous pouvez maintenant vous connecter.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// Redirection vers la page de connexion</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">redirectToRoute</span><span class="token punctuation">(</span><span class="token string">'auteur_login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'auteur/register.html.twig'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token string">'form'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$form</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">createView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Et la vue templates/auteur/register.html.twig :</p>
<pre class=" language-twig"><code class="prism  language-twig"><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">extends</span></span> <span class="token string"><span class="token punctuation">'</span>base.html.twig<span class="token punctuation">'</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span>

<span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">block</span></span> <span class="token property">title</span> <span class="token rd"><span class="token punctuation">%}</span></span></span><span class="token other">Inscription</span><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">endblock</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span>

<span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">block</span></span> <span class="token property">body</span> <span class="token rd"><span class="token punctuation">%}</span></span></span>
<span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container mt-5<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>row<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>col-md-6 mx-auto<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>card<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>card-header<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text-center<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Inscription<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>card-body<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></span>
                    <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">for</span></span> <span class="token property">flash_error</span> <span class="token operator">in</span> <span class="token property">app</span><span class="token punctuation">.</span><span class="token property">flashes</span><span class="token punctuation">(</span><span class="token string"><span class="token punctuation">'</span>error<span class="token punctuation">'</span></span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">%}</span></span></span>
                        <span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>alert alert-danger<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></span><span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">flash_error</span> <span class="token rd"><span class="token punctuation">}}</span></span></span><span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
                    <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">endfor</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span>
                    
                    <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">form_theme</span></span> <span class="token property">form</span> <span class="token string"><span class="token punctuation">'</span>bootstrap_5_layout.html.twig<span class="token punctuation">'</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span>
                    <span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">form</span><span class="token punctuation">(</span><span class="token property">form</span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">}}</span></span></span>
                <span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">endblock</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span>
</code></pre>
<hr>
<p>Written with ❤️ by Adapted from <a href="https://github.com/hugoliegeard">Hugo LIEGEARD</a>.</p>
</div>
</body>

</html>
